//NOT Working

module.exports = function() {
	var jwt = require('jwt-simple');
	var secret = 'secretgoeshere';
	// console.log(req.header('x-annotator-auth-token')); //=> { foo: 'bar' }

	function tokenOK (req, res, next) {
		var decoded = jwt.decode(req.header('x-annotator-auth-token'), secret);
		next();
	}

	function loadUser(req, res, next) {
		// You would fetch your user from the db
		var user = users[req.params.id];
		if (user) {
			req.user = user;
			next();
		} else {
			next(new Error('Failed to load user ' + req.params.id));
		}
	}

	function andRestrictToSelf(req, res, next) {
		// If our authenticated user is the user we are viewing
		// then everything is fine :)
		if (req.authenticatedUser.id == req.user.id) {
			next();
		} else {
			// You may want to implement specific exceptions
			// such as UnauthorizedError or similar so that you
			// can handle these can be special-cased in an error handler
			// (view ./examples/pages for this)
			next(new Error('Unauthorized'));
		}
	}

	function andRestrictTo(role) {
		return function(req, res, next) {
			if (req.authenticatedUser.role == role) {
				next();
			} else {
				next(new Error('Unauthorized'));
			}
		}
	};
};