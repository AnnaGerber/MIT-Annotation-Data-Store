<!DOCTYPE html>
<html lang="en">
  <head>
	    <meta charset="utf-8">
	    <title>annotat.io</title>
		<link rel="stylesheet" href="/lib/css/bootstrap.min.css" type="text/css" media="screen" title="no title" charset="utf-8">
	    <link href="/lib/img/apple-touch-icon.png" rel="apple-touch-icon">
	    <link href="/lib/img/apple-touch-icon-72x72.png" rel="apple-touch-icon" sizes="72x72">
	    <link href="/lib/img/apple-touch-icon-114x114.png" rel="apple-touch-icon" sizes="114x114">
	    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	    <!--[if lt IE 9]>
	      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
	    <![endif]-->

	    <!-- Le styles -->
	    <style>
	      body {
	        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
	      }
	    </style>
		</head>
	  <body>

	    <div class="navbar navbar-fixed-top">
	      <div class="navbar-inner">
	          <div class="container">
	          <a class="btn btn-navbar" data-target=".nav-collapse" data-toggle="collapse">
	            <span class="icon-bar"></span>
	            <span class="icon-bar"></span>
	            <span class="icon-bar"></span>
	          </a>
	          <a class="brand" href="/">annotat.io</a>
	          <div class="container nav-collapse">
	            <ul class="nav">
	                <li><a href="/frontend.html#list" />Annotations</a></li>
	                <li><a href="http://blooming-samurai-2296.herokuapp.com/" />Annotation Studio</a></li>
	            </ul>
	          </div><!--/.nav-collapse -->
	        </div>
	      </div>
	    </div>

	<div class="container">

		<div class="row">
		  <div class="span8">
		    <section id="container">
		      <h1>All Annotations</h1>
		      <p>
		        To render the annotation list use the route '<a href="#list">#list</a>' following the url for this page
		      </p>
		    </section> <!-- /container -->

		    <script type="text/template" id="annotation-template">
			<ul>
			{{#rows}}
			  <li><a href="/api/annotations/{{_id}}">{{text}}</a> :: {{quote}}</li>
			{{/rows}}
			</ul>
		    </script>

		    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
		    <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js"></script>
		    <script src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/0.9.2/backbone-min.js"></script>
		    <script src="http://cdnjs.cloudflare.com/ajax/libs/mustache.js/0.4.2/mustache.min.js"></script>

		    <script>
		        PX = window.PX || {};

		        // model
		        PX.Annotation = Backbone.Model.extend({
		            defaults: {
		                quote: null,
		                text: null
		            }
		        });

		        // collection
		        (function () {
		            var AnnotationList;

		            AnnotationList = Backbone.Collection.extend({
		                model: PX.Annotation,
		                url: '/api/search?uri=http://blooming-samurai-2296.herokuapp.com/collections/3/documents/5',
		                initialize: function () {
		                    this.fetch({
		                        success: this.fetchSuccess,
		                        error: this.fetchError
		                    });
		                    this.deferred = new $.Deferred();
		                },
		                deferred: Function.constructor.prototype,
		                fetchSuccess: function (collection, response) {
		                    collection.deferred.resolve();
		                },
		                fetchError: function (collection, response) {
		                    throw new Error("Annotations fetch did get collection from API");
		                }
		            });

		            PX.annotations = new AnnotationList();
		            AnnotationList = null;
		        }());


		        PX.AnnotationView = Backbone.View.extend({
		            className: "annotation",
		            initialize: function (options) {
		                this.template = $('#annotation-template').html();
		            },
		            render: function () {
		                var markup = Mustache.to_html(this.template, this.model.toJSON());
		                this.$el.html(markup).attr('id',this.model.get('_id'));
		                return this;
		            }
		        });

		        PX.AnnotationListView = Backbone.View.extend({
		            className: "annotations",
		            // initialize: function (options) {
		            //     this.container = options.container;
		            // },
		            render: function () {
		                var i, len = this.collection.length;
		                for (i=0; i < len; i++) {
		                    this.renderItem(this.collection.models[i]);
		                };
		                $(this.container).find(this.className).remove();
		                this.$el.appendTo(this.options.container);
		                return this;
		            },
		            renderItem: function (model) {
		                var item = new PX.AnnotationView({
		                    "model": model
		                });
		                item.render().$el.appendTo(this.$el);
		            }
		        });

		        // application
		        PX.App = Backbone.Router.extend({
		            routes: {
		                "/": "listAnnotations",
		                "list": "listAnnotations"
		            },
		            //initialize: function (options) {},
		            listAnnotations: function () {
		                var annotationsList = new PX.AnnotationListView({
		                    "container": $('#container'),
		                    "collection": PX.annotations
		                });
		                PX.annotations.deferred.done(function () {
		                    annotationsList.render();
		                });
		            }
		        });

		        // bootstrap
		        PX.app = new PX.App();
		        Backbone.history.start();
		    </script>
		  </div> <!-- span8 -->
		  <div class="span4">...</div>
		</div> <!-- row -->
	</div><!-- container -->
  </body>
</html>
